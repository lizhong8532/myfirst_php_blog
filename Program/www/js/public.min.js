function subComment(g){butStatus(g,1);var h=$.trim($(".comment :input[name=user]").val());var a=$.trim($(".comment :input[name=email]").val());var f=$(".comment :input[name=b_date]").val();var d=$.trim($(".comment :input[name=url]").val());var e=$.trim($(".comment textarea").val());var c=$(".comment :input[name=b_id]").val();var b=$(".comment :input[name=c_parent]").val();if(h==""||a==""||e==""){alert("\u8981\u586b\u5199\u4e1c\u4e1c\u540e\u624d\u80fd\u63d0\u4ea4\uff0c\u6728\u8981\u968f\u4fbf\u4e71\u70b9\u54e6\uff01");return butStatus(g,2)}if(getStrLeng(h)>30){alert("\u6635\u79f0\u8fc7\u957f\u4e86\u54e6");return butStatus(g,2)}if(getStrLeng(a)>50){alert("\u90ae\u7bb1\u8fc7\u957f\u4e86\u54e6");return butStatus(g,2)}if(!c_email(a)){alert("\u90ae\u7bb1\u683c\u5f0f\u9519\u8bef\u4e86\u54e6");return butStatus(g,2)}if(getStrLeng(d)>30){alert("URL\u8fc7\u957f\u4e86\u54e6");return butStatus(g,2)}if(!c_url(d)){alert("URL\u683c\u5f0f\u9519\u8bef\u4e86\u54e6!!");return butStatus(g,2)}if(getStrLeng(e)>600){alert("\u5185\u5bb9\u5b57\u6570\u8fc7\u591a\u4e86\u54e6");return butStatus(g,2)}$.post("http://www.qttc.net/api.php?action=subComment",{b_id:c,user:encodeURIComponent(h),email:encodeURIComponent(a),url:encodeURIComponent(d),b_date:f,comment:encodeURIComponent(e),c_parent:b},function(k){if(k.error===0){$(".comment :input[name=comment]").val("");cancel_reply();e=regFace(e);if(b==0){var l='<li><a href="http://www.qttc.net/user/'+k.c_md5+'" target="_blank"><img src="http://www.gravatar.com/avatar/'+k.c_md5+'.jpg?s=60$d=&r=G" /></a><div class="reply_right"><div><a href="http://www.qttc.net/user/'+k.c_md5+'" target="_blank">'+h+"</a></div><div>"+e+'</div><div class="triangles"></div><div class="reply_info"><span>1 seconds ago</span></div></div><div class="clearit"></div></li>';$(".comment_list ul").append(l)}else{var l='[{"c_user":"'+h+'","c_email":"'+a+'","c_parent":"'+b+'","c_date":"'+k.date+'","c_content":"'+e+'","c_md5":"'+k.c_md5+'","c_id":"","c_url":"'+d+'"}]';reply_append(l);var i=window.location.href.split("#");window.location.href=i[0]+"#"+b}alert("\u8bc4\u8bba\u6210\u529f\uff01");checkTT($(".comment textarea").get(0));var j=$(".comment_list>h3>span");var m=Number(j.html());m++;j.html(m)}else{alert(k.msg)}butStatus(g,2)},"json")}function regFace(a){return a.replace(/\[(smile|mrgreen|razz|lol|redface|biggrin|sad|surprised|wink|neutral|cool|arrow|evil|cry|eek|confused|exclaim|rolleyes|question|mad|idea|twisted)\]/g,function(b,c){return"<img src='http://www.qttc.net/images/ico/icon_"+c+".gif' />"})}function butStatus(b,a){$obj=$(b);if(a==1){$obj.css("color","#666").attr("disabled",true).val("sendding...");return true}if(a==2){$obj.css("color","#270").attr("disabled",false).val("submit");return false}}function reply_append(data){var list=eval(data);for(var i=0,k=list.length;i<k;i++){var str='<div class="reply_box"><a href="http://www.qttc.net/user/'+list[i].c_md5+'" target="_blank"><img src="http://www.gravatar.com/avatar/'+list[i].c_md5+'.jpg?s=60$d=&r=G" /></a><div class="reply_box_right"><div><a href="http://www.qttc.net/user/'+list[i].c_md5+'" target="_blank">'+list[i].c_user+"</a></div><div>"+list[i].c_content+'</div><div class="reply_info"><span>'+list[i]["c_date"].substr(0,16)+'</span></div></div><div class="clearit"></div></div>';$(".comment_list #"+list[i].c_parent+" .reply_right").append(str)}}function reply_comment(a,b){$(".comment p:eq(0)").html("\u8ddf\u5e16 @ "+b+'\uff0c<a onclick="cancel_reply();" href="javascript:void(0);">Click here to cancel | \u70b9\u51fb\u8fd9\u91cc\u53d6\u6d88</a>');$(".comment :input[name='c_parent']").val(a);window.location.href="#comment";$(".comment :input[name='user']")[0].focus()}function cancel_reply(){$(".comment p:eq(0)").html("");$(".comment :input[name='c_parent']").val(0)}function GetCookieVal(b){var a=document.cookie.indexOf(";",b);if(a==-1){a=document.cookie.length}return unescape(document.cookie.substring(b,a))}function SetCookie(a,c){var b=new Date();b.setTime(b.getTime()+24*60*60*1000);document.cookie=a+"="+escape(GetCookie(a)+","+c)+"; expires="+b.toGMTString()}function GetCookie(d){var b=d+"=",f=b.length,a=document.cookie.length,e=0;while(e<a){var c=e+f;if(document.cookie.substring(e,c)==b){return GetCookieVal(c)}e=document.cookie.indexOf(" ",e)+1;if(e==0){break}}return 0}function zhichi(b,a){var c=GetCookie("bid"),d=(","+c+",").lastIndexOf(","+b+",");if(d!=-1){alert("\u62b1\u6b49\uff01\u60a8\u5728\u4e00\u5929\u65f6\u95f4\u5185\u4e0d\u80fd\u591a\u6b21\u70b9\u51fb\u3010\u652f\u6301\u4e00\u4e0b\u3011\u8fd9\u7bc7\u535a\u6587\uff01")}else{$.post("http://www.qttc.net/api.php?action=zhichi",{b_id:b});SetCookie("bid",b);$(".blog .zhichi>a").html("\u652f\u6301\u4e00\u4e0b\uff08"+(++a)+"\uff09")}}function addExpression(c){var e=$(".comment textarea").get(0);if(document.selection){e.focus();slt=document.selection.createRange();slt.text=c;e.focus()}else{if(e.selectionStart||e.selectionStart=="0"){var b=e.selectionStart;var a=e.selectionEnd;var d=a;e.value=e.value.substring(0,b)+c+e.value.substring(a,e.value.length);d+=c.length;e.focus();e.selectionStart=d;e.selectionEnd=d}else{e.value+=c;e.focus()}}}function checkTT(b){var a=$(".comment textarea").next();var c=200-Math.ceil(getStrLeng(b.value)/3);a.html(c);if(c>=0){a.css("color","#333")}else{a.css("color","red")}}function c_email(a){var b=/^([a-zA-Z0-9]{1,40})(([\_\-\.])?([a-zA-Z0-9]{1,40}))*@([a-zA-Z0-9]{1,20})(([\-\_])?([a-zA-Z0-9]{1,20}))*(\.[a-z]{2,4}){1,2}$/;if(b.test(a)){return true}else{return false}}function c_url(a){if(a==""){return true}var b=/^(http:\/\/)?(www\.)?([a-zA-Z0-9]{1,20})(([\_\-])?([a-zA-Z0-9]{1,20}))*(\.[a-z]{2,4}){1,2}([\/])?$/;if(b.test(a)){return true}else{return false}}function getStrLeng(d){var e=0,a=d.length,b=-1;for(var c=0;c<a;c++){b=d.charCodeAt(c);if(b>=0&&b<=128){e+=1}else{e+=3}}return e}function xgbw(a){$("div.liebiao>ul.xgbw").prev().hide();$.get("http://www.qttc.net/api.php?action=xgbw&cg_id="+a,function(b){if(b.error===0){$("div.liebiao>ul.xgbw").html(b.data)}$("div.liebiao>ul.xgbw").prev().show()},"json")}function rand(){$("div.liebiao>ul.rand").prev().hide();$.get("http://www.qttc.net/api.php?action=rand",function(a){if(a.error===0){$("div.liebiao>ul.rand").html(a.data)}$("div.liebiao>ul.rand").prev().show()},"json")}var sousuo={obj:null,default_color:"",default_value:"\u641c\u7d22\uff0c\u539f\u6765\u8fd9\u4e48\u7b80\u5355",bind_key:function(){var a=this;a.obj.find(">:input").keydown(function(c){var b=c||window.event;b.keyCode==13&&a.sub()}).focus(function(){$.trim($(this).val())==a.default_value&&$(this).css("color",a.default_color).val("")}).blur(function(){$.trim($(this).val())==""&&a.def()})},def:function(){var a=this;a.obj.find(">:input").val(a.default_value).css("color","#ccc")},bind_btn:function(){var a=this;a.obj.find(">span").click(function(){a.sub()})},sub:function(){var b=this;var a=$.trim(b.obj.find(">input").val());a!=""&&(window.location.href="http://www.qttc.net/search/"+a)},init:function(a){this.obj=$(a);this.default_color=this.obj.css("color");$.trim(this.obj.find(">:input").val())==""&&this.def();this.bind_btn(a);this.bind_key(a)}};(function(a){a.fn.img_dialog=function(){var e=200;var g=null;var d=false;var c="";c+='<div class="img_dialog_bg" style="width:100%;background:#000;opacity:0.7;filter:alpha(opacity=70);position:absolute;left:0;top:0;z-index:2147483600;display:none;"></div>';c+='<div class="img_dialog" style="display:none;position:fixed;border:5px solid #FFF;left:50%;z-index:2147483601;top:50%;"></div>';a("body").append(c);var b=a(".img_dialog");var f=a(".img_dialog_bg");a(this).each(function(){g=a(this);g.click(function(){if(a(this).attr("src").substr(-11)=="loading.gif"){return false}a(this).css("cursor","pointer").attr("title","\u70b9\u51fb\u5173\u706f\u663e\u793a");f.css("height",a(document).height()+"px").show();var i=new Image();i.src=a(this).attr("src");var j="-"+parseInt(i.width/2)+"px";var h="-"+parseInt(i.height/2)+"px";b.css({"margin-left":j,"margin-top":h}).html(i).fadeIn(e);i=null});f.click(function(){if(d){return false}d=true;b.fadeOut(e,function(){f.fadeOut(parseInt(e/2),function(){d=false});a(this).html("")})})})}})(jQuery);$(".comment p a").click(function(){addExpression("["+$(this).attr("title")+"]")});sousuo.init(".search");$(".blog img").img_dialog();$("img").lazyload({effect:"fadeIn"});
